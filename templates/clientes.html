<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Clientes - FacturaciÃ³n ElectrÃ³nica</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">

</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
  <div class="container-fluid">
    <a class="navbar-brand" href="{{ url_for('dashboard') }}">ğŸ’¼ FacturaciÃ³n ElectrÃ³nica</a>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav me-auto">
        <!-- âœ… Enlace corregido -->
        <li class="nav-item"><a class="nav-link active" href="{{ url_for('clientes_listar') }}">Clientes</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('productos_listar') }}">Productos</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('ventas') }}">Ventas</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('reportes') }}">Reportes</a></li>
      </ul>
      <span class="navbar-text me-3">ğŸ‘‹ {{ user.username }}</span>
      <a href="{{ url_for('logout') }}" class="btn btn-outline-light btn-sm">Salir</a>
    </div>
  </div>
</nav>

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>ğŸ‘¥ Clientes</h4>
        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalAgregar">â• Nuevo Cliente</button>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <table id="tablaClientes" class="display table table-striped table-bordered">
        <thead class="table-primary">
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>DUI</th>
                <th>NIT</th>
                <th>Email</th>
                <th>TelÃ©fono</th>
                <th>DirecciÃ³n</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for c in clientes %}
            <tr>
                <td>{{ c.id }}</td>
                <td>{{ c.name }}</td>
                <td>{{ c.dui or '-' }}</td>
                <td>{{ c.nit or '-' }}</td>
                <td>{{ c.email or '-' }}</td>
                <td>{{ c.phone or '-' }}</td>
                <td>{{ c.address or '-' }}</td>
                <td>
                    <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#modalEditar{{ c.id }}">âœï¸</button>
                    <!-- âœ… Enlace corregido -->
                    <a href="{{ url_for('clientes_eliminar', id=c.id) }}" class="btn btn-sm btn-danger" onclick="return confirm('Â¿Eliminar cliente?')">ğŸ—‘ï¸</a>
                </td>
            </tr>

            <!-- Modal editar -->
            <div class="modal fade" id="modalEditar{{ c.id }}" tabindex="-1">
              <div class="modal-dialog">
                <!-- âœ… AcciÃ³n corregida -->
                <form method="POST" action="{{ url_for('clientes_editar', id=c.id) }}" class="modal-content">
                  <div class="modal-header bg-warning">
                    <h5 class="modal-title">Editar Cliente</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                  </div>
                  <div class="modal-body">
                    <div class="mb-2"><label>Nombre</label><input name="nombre" class="form-control" value="{{ c.name }}" required></div>
                    <div class="mb-2"><label>DUI</label><input name="dui" class="form-control" value="{{ c.dui }}"></div>
                    <div class="mb-2"><label>NIT</label><input name="nit" class="form-control" value="{{ c.nit }}"></div>
                    <div class="mb-2"><label>Email</label><input name="email" class="form-control" value="{{ c.email }}"></div>
                    <div class="mb-2"><label>TelÃ©fono</label><input name="telefono" class="form-control" value="{{ c.phone }}"></div>
                    <div class="mb-2"><label>DirecciÃ³n</label><textarea name="direccion" class="form-control">{{ c.address }}</textarea></div>
                  </div>
                  <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button class="btn btn-warning" type="submit">Guardar Cambios</button>
                  </div>
                </form>
              </div>
            </div>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Modal agregar -->
<div class="modal fade" id="modalAgregar" tabindex="-1">
  <div class="modal-dialog">
    <!-- âœ… AcciÃ³n corregida -->
    <form method="POST" action="{{ url_for('clientes_agregar') }}" class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title">Agregar Cliente</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-2"><label>Nombre</label><input name="nombre" class="form-control" required></div>
        <div class="mb-2"><label>DUI</label><input name="dui" class="form-control"></div>
        <div class="mb-2"><label>NIT</label><input name="nit" class="form-control"></div>
        <div class="mb-2"><label>Email</label><input name="email" class="form-control"></div>
        <div class="mb-2"><label>TelÃ©fono</label><input name="telefono" class="form-control"></div>
        <div class="mb-2"><label>DirecciÃ³n</label><textarea name="direccion" class="form-control"></textarea></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button class="btn btn-success" type="submit">Guardar</button>
      </div>
    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
$(document).ready(function() {
    $('#tablaClientes').DataTable({
        language: {
            url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json'
        }
    });
});
</script>
</body>
</html>
